<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Location-based AR.js with LocAR.js - AR.js Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">AR.js Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../image-tracking/" class="nav-link">Image Tracking</a>
                            </li>
                            <li class="navitem">
                                <a href="../../location-based/" class="nav-link">Location Based</a>
                            </li>
                            <li class="navitem">
                                <a href="../../marker-based/" class="nav-link">Marker Based</a>
                            </li>
                            <li class="navitem">
                                <a href="../../ui-events/" class="nav-link">UI and Events</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-light">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#location-based-arjs-with-locarjs" class="nav-link">Location-based AR.js with LocAR.js</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#part-1-hello-world" class="nav-link">Part 1 - Hello World!</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="location-based-arjs-with-locarjs">Location-based AR.js with LocAR.js</h1>
<h2 id="part-1-hello-world">Part 1 - Hello World!</h2>
<p>The first part of this tutorial will show you how to create a "hello world" application using LocAR.js. It is assumed you are aware of basic three.js concepts, such as the scene, renderer and camera as well as geometries, materials and meshes. This example will set your location to a "fake" GPS location and add a box a short distance away.</p>
<p>Let's start with the HTML, which is very simple:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;LocAR.js - Hello World&lt;/title&gt;
&lt;script type='module' src='src/main.js'&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>This example assumes that you have installed LocAR.js via <code>npm</code> and are using Vite in dev mode to run the application, as described on the <a href="../">index page for the tutorial</a>. We link in our JavaScript source as an ES6 module from <code>src/main.js</code>, so this is where you should save your code, as <code>main.js</code> inside the <code>src</code> directory. Here is the <code>main.js</code> code:</p>
<pre><code class="language-javascript">import * as THREE from 'three';
import * as LocAR from 'locar';

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.001, 100);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

window.addEventListener(&quot;resize&quot;, e =&gt; {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;    
    camera.updateProjectionMatrix();
});
const box = new THREE.BoxGeometry(2,2,2);
const cube = new THREE.Mesh(box, new THREE.MeshBasicMaterial({ color: 0xff0000 }));

const locar = new LocAR.LocationBased(scene, camera);
const cam = new LocAR.WebcamRenderer(renderer);


locar.fakeGps(-0.72, 51.05);
locar.add(cube, -0.72, 51.0501);

renderer.setAnimationLoop(animate);


function animate() {
    cam.update();
    renderer.render(scene, camera);
}

</code></pre>
<p>Much of this is using standard three.js setup code as described in the <a href="https://threejs.org/docs/index.html#manual/en/introduction/Creating-a-scene">manual</a>; if you do not understand basic three.js concepts such as the scene, camera, and renderer, as well as geometries and meshes, you should read the three.js manual first. </p>
<p>As normal, we create a <code>THREE.Scene</code>, a <code>THREE.PerspectiveCamera</code> and a <code>THREE.WebGLRenderer</code> using our canvas. We also handle resizing the window and handle window resize. We then create a box geometry and a mesh using that box geometry.</p>
<p>What comes next though is new, and specific to AR.js:</p>
<pre><code class="language-javascript">const locar = new LocAR.LocationBased(scene, camera);
const cam = new LocAR.WebcamRenderer(renderer);
</code></pre>
<p>We use two new objects, both part of the LocAR.js API. Firstly <code>LocAR.LocationBased</code> is the overall AR.js "manager" object and secondly <code>LocAR.WebcamRenderer</code> is responsible for rendering the live camera feed. We need to supply our scene and camera as arguments to <code>LocAR.LocationBased</code> and our renderer as an argument to <code>LocAR.WebcamRenderer</code>.</p>
<p>The <code>LocAR.WebcamRenderer</code> will, internally, create a <code>video</code> element to capture the webcam. Alternatively, if you have a <code>video</code> element already set up in your HTML, you can pass its CSS selector into the <code>WebcamRenderer</code> as an optional argument. For example:</p>
<pre><code class="language-javascript">const cam = new LocAR.WebcamRenderer(renderer, '#video1');
</code></pre>
<p>Next we add our box mesh to LocAR. This next line is interesting: </p>
<pre><code class="language-javascript">locar.add(box, -0.72, 51.051); 
</code></pre>
<p>Rather than setting the box's <code>position</code> as we would normally do in standard three.js, we add it to a specific <strong>real-world location</strong> defined by longitude and latitude. The <code>add()</code> method of <code>LocAR.LocationBased</code> allows us to do that.</p>
<p>Having positioned our box in a specific real-world location, we now need to place <strong>ourselves</strong> (i.e. the camera) at a given real-world location We can do this with <code>LocAR.LocationBased</code>s <code>fakeGps()</code> method, which takes longitude and latitude as parameters:</p>
<pre><code class="language-javascript">arjs.fakeGps(-0.72, 51.05);
</code></pre>
<p>This places us just to the south of the red box. By default, we face north, so the red box will appear in front of us.</p>
<p>The remaining code is the standard three.js code for defining a rendering function and setting it as the animation loop. However note this code within the rendering function:</p>
<pre><code class="language-javascript">cam.update();
</code></pre>
<p>This API call will render the latest camera frame.</p>
<h3 id="try-it">Try it!</h3>
<p>Try it on either a desktop machine or an Android device running Chrome. On a mobile device or desktop you should see the feed from the webcam, and a red box just in front of you. Note that the mobile device will not yet respond to changes in orientation: we will add that next time. For this reason you <em>must ensure the box is to your north</em> as the default view is to face north.</p>
<h3 id="faking-rotation-on-a-desktop-machine">Faking rotation on a desktop machine</h3>
<p>If you do not have a suitable mobile device, you can simulate rotation with the mouse. The code below will do this (add to your main block of code, just before the rendering function):</p>
<pre><code class="language-javascript">const rotationStep = THREE.Math.degToRad(2);

let mousedown = false, lastX =0;

window.addEventListener(&quot;mousedown&quot;, e=&gt; {
    mousedown = true;
});

window.addEventListener(&quot;mouseup&quot;, e=&gt; {
    mousedown = false;
});

window.addEventListener(&quot;mousemove&quot;, e=&gt; {
    if(!mousedown) return;
    if(e.clientX &lt; lastX) {
        camera.rotation.y -= rotationStep;
        if(camera.rotation.y &lt; 0) {
            camera.rotation.y += 2 * Math.PI;
        }
    } else if (e.clientX &gt; lastX) {
        camera.rotation.y += rotationStep;
        if(camera.rotation.y &gt; 2 * Math.PI) {
            camera.rotation.y -= 2 * Math.PI;
        }
    }
    lastX = e.clientX;
});
</code></pre>
<p>What does this do? Using mouse events, it detects the direction of movement of the mouse when it's pressed down, and in doing so, determines whether to rotate the camera clockwise or anticlockwise. It does this using the <code>clientX</code> property of the event object, which contains the mouse X position. This is compared to the previous value of <code>e.clientX</code> and from this, we can determine whether we moved the mouse to the left or to the right, and rotate accordingly.</p>
<p>We move the camera by the amount specified in <code>rotationStep</code> and ensure that the camera rotation is always within the range 0 to 2PI radians (i.e. 360 degrees).</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
