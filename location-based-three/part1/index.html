<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Location-based AR.js with three.js - AR.js Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">AR.js Documentation</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li >
                                <a href="../../image-tracking/">Image Tracking</a>
                            </li>
                            <li >
                                <a href="../../location-based/">Location Based</a>
                            </li>
                            <li >
                                <a href="../../marker-based/">Marker Based</a>
                            </li>
                            <li >
                                <a href="../../ui-events/">UI and Events</a>
                            </li>
                            <li >
                                <a href="../../about/">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#location-based-arjs-with-threejs">Location-based AR.js with three.js</a></li>
            <li><a href="#part-1-hello-world">Part 1 - Hello World!</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="location-based-arjs-with-threejs">Location-based AR.js with three.js</h1>
<h2 id="part-1-hello-world">Part 1 - Hello World!</h2>
<p>The first part of this tutorial will show you how to create a "hello world" application using the pure three.js API for location-based ar.js. It is assumed you are aware of basic three.js concepts, such as the scene, renderer and camera as well as geometries, materials and meshes. This example will set your location to a "fake" GPS location and add a box a short distance away.</p>
<p>Let's start with the HTML:</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Location-based AR.js with three.js&lt;/title&gt;
&lt;script type='module' src='dist/bundle.js'&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;canvas id='canvas1' style='background-color: black; width: 100%; height: 100%'&gt;&lt;/canvas&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>This example assumes that you have installed AR.js via <code>npm</code> and used Webpack to build the application, as described on the <a href="../">index page for the tutorial</a>. We link in the built bundle of our own code plus the three.js and AR.js dependencies. Here is our own code: save this as <code>index.js</code>.</p>
<pre><code class="javascript">
import * as THREE from 'three';
import * as THREEx from './node_modules/@ar-js-org/ar.js/three.js/build/ar-threex-location-only.js';

function main() {
    const canvas = document.getElementById('canvas1');

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, 1.33, 0.1, 10000);
    const renderer = new THREE.WebGLRenderer({canvas: canvas});

    const arjs = new THREEx.LocationBased(scene, camera);
    const cam = new THREEx.WebcamRenderer(renderer);

    const geom = new THREE.BoxGeometry(20, 20, 20);
    const mtl = new THREE.MeshBasicMaterial({color: 0xff0000});
    const box = new THREE.Mesh(geom, mtl);
    arjs.add(box, -0.72, 51.051); 


    arjs.fakeGps(-0.72, 51.05);

    requestAnimationFrame(render);

    function render() {
        if(canvas.width != canvas.clientWidth || canvas.height != canvas.clientHeight) {
            renderer.setSize(canvas.clientWidth, canvas.clientHeight, false);
            const aspect = canvas.clientWidth/canvas.clientHeight;
            camera.aspect = aspect;
            camera.updateProjectionMatrix();
        }
        cam.update();
        renderer.render(scene, camera);
        requestAnimationFrame(render);
    }
}

main();
</code></pre>

<p>Much of this should be familiar to you from basic three.js examples, and is written in the same style as the <a href="https://threejs.org/manual">manual</a>. As normal, we create a <code>THREE.Scene</code>, a <code>THREE.PerspectiveCamera</code> and a <code>THREE.WebGLRenderer</code> using our canvas. </p>
<p>What comes next though is new, and specific to AR.js:</p>
<pre><code class="javascript">const arjs = new THREEx.LocationBased(scene, camera);
const cam = new THREEx.WebcamRenderer(renderer);
</code></pre>

<p>We use two new objects, both part of the AR.js API. Firstly <code>THREEx.LocationBased</code> is the overall AR.js "manager" object and secondly <code>THREEx.WebcamRenderer</code> is responsible for rendering the camera feed. We need to supply our scene and camera as arguments to <code>THREEx.LocationBased</code> and our renderer as an argument to <code>THREEx.WebcamRenderer</code>.</p>
<p>The <code>THREEx.WebcamRenderer</code> will create a <code>video</code> element to capture the webcam. Alternatively, if you have a <code>video</code> element already set up in your HTML, you can pass its CSS selector into the <code>WebcamRenderer</code> as an optional argument. For example:</p>
<pre><code class="javascript">const cam = new THREEx.WebcamRenderer(renderer, '#video1');
</code></pre>

<p>Next, using standard three.js code, we set up a mesh using a box geometry and red material (i.e. a red box). However, this is where it then gets interesting:</p>
<pre><code class="javascript">arjs.add(box, -0.72, 51.051); 
</code></pre>

<p>Rather than setting the box's <code>position</code> as we would normally do in standard three.js, we add it to a specific <strong>real-world location</strong> defined by longitude and latitude. The <code>add()</code> method of <code>THREEx.LocationBased</code> allows us to do that.</p>
<p>Having positioned our box in a specific real-world location, we now need to place <strong>ourselves</strong> (i.e. the camera) at a given real-world location We can do this with <code>THREEx.LocationBased</code>s <code>fakeGps()</code> method, which takes longitude and latitude as parameters:</p>
<pre><code class="javascript">arjs.fakeGps(-0.72, 51.05);
</code></pre>

<p>This plaves us just to the south of the red box. By default, we face north, so the red box will appear in front of us.</p>
<p>The remaining code is the standard three.js code for rendering each frame, and dealing with potential screen resizes. However note this code within the rendering function:</p>
<pre><code class="javascript">cam.update();
</code></pre>

<p>This API call will render the latest camera frame.</p>
<h3 id="try-it">Try it!</h3>
<p>Try it on either a desktop machine or an Android device running Chrome. On a mobile device or desktop you should see the feed from the webcam, and a red box just in front of you. Note that the mobile device will not yet respond to changes in orientation: we will add that next time. For this reason you <em>must ensure the box is to your north</em> as the default view is to face north.</p>
<h3 id="faking-rotation-on-a-desktop-machine">Faking rotation on a desktop machine</h3>
<p>If you do not have a suitable mobile device, you can simulate rotation with the mouse. The code below will do this (add to your main block of code, just before the rendering function):</p>
<pre><code class="javascript">const rotationStep = THREE.Math.degToRad(2);

let mousedown = false, lastX =0;

window.addEventListener(&quot;mousedown&quot;, e=&gt; {
    mousedown = true;
});

window.addEventListener(&quot;mouseup&quot;, e=&gt; {
    mousedown = false;
});

window.addEventListener(&quot;mousemove&quot;, e=&gt; {
    if(!mousedown) return;
    if(e.clientX &lt; lastX) {
        camera.rotation.y -= rotationStep;
        if(camera.rotation.y &lt; 0) {
            camera.rotation.y += 2 * Math.PI;
        }
    } else if (e.clientX &gt; lastX) {
        camera.rotation.y += rotationStep;
        if(camera.rotation.y &gt; 2 * Math.PI) {
            camera.rotation.y -= 2 * Math.PI;
        }
    }
    lastX = e.clientX;
});
</code></pre>

<p>What does this do? Using mouse events, it detects the direction of movement of the mouse when it's pressed down, and in doing so, determines whether to rotate the camera clockwise or anticlockwise. It does this using the <code>clientX</code> property of the event object, which contains the mouse X position. This is compared to the previous value of <code>e.clientX</code> and from this, we can determine whether we moved the mouse to the left or to the right, and rotate accordingly.</p>
<p>We move the camera by the amount specified in <code>rotationStep</code> and ensure that the camera rotation is always within the range 0 to 2PI radians (i.e. 360 degrees).</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
